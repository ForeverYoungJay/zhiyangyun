# A1-M1 设计清单：资产与房间管理

## 1) 页面清单（Web：Vue3 + TS + Element Plus）

1. 资产总览页 `/assets/overview`
   - 指标：楼栋数、房间数、床位数、空床位、维修床位
2. 楼栋管理页 `/assets/buildings`
   - 列表、创建、编辑、删除
3. 楼层管理页 `/assets/floors`
   - 按楼栋筛选，列表、创建、编辑、删除
4. 房间管理页 `/assets/rooms`
   - 按楼栋/楼层筛选，列表、创建、编辑、删除
5. 床位管理页 `/assets/beds`
   - 按房间筛选，列表、创建、编辑、状态变更（vacant/occupied/maintenance/reserved）
6. 二维码管理页 `/assets/qrcodes`
   - 展示 room_code / bed_code（M1 先文本与图片占位，M2 接入真实二维码生成）

## 2) API 清单（统一前缀 `/api/v1`）

统一返回格式：
```json
{ "success": true, "message": "ok", "data": {} }
```

### Auth/RBAC（M1 最小可用）
- POST `/auth/login`
  - req: `{ username, password }`
  - res: `{ access_token, token_type, user }`
- GET `/auth/me`
  - res: 当前用户信息与角色

### 资产模块
- GET `/assets/overview`
- Buildings:
  - GET `/buildings`
  - POST `/buildings`
  - PUT `/buildings/{id}`
  - DELETE `/buildings/{id}`
- Floors:
  - GET `/floors?building_id=`
  - POST `/floors`
  - PUT `/floors/{id}`
  - DELETE `/floors/{id}`
- Rooms:
  - GET `/rooms?building_id=&floor_id=`
  - POST `/rooms`
  - PUT `/rooms/{id}`
  - DELETE `/rooms/{id}`
- Beds:
  - GET `/beds?room_id=&status=`
  - POST `/beds`
  - PUT `/beds/{id}`
  - POST `/beds/{id}/status`

## 3) 表结构清单（全部含 tenant_id）

### 通用用户权限
1. `users`
- id(uuid), tenant_id(uuid, idx), username(unique), password_hash, real_name, is_active, created_at, updated_at
2. `roles`
- id, tenant_id(idx), code(unique by tenant), name
3. `permissions`
- id, code(unique), name
4. `user_roles`
- id, tenant_id(idx), user_id(fk), role_id(fk), unique(tenant_id,user_id,role_id)
5. `role_permissions`
- id, tenant_id(idx), role_id(fk), permission_id(fk), unique(tenant_id,role_id,permission_id)

### 资产房间
6. `buildings`
- id, tenant_id(idx), code, name, address, is_active, created_at, updated_at
- unique(tenant_id, code)
7. `floors`
- id, tenant_id(idx), building_id(fk), floor_no, name
- unique(tenant_id, building_id, floor_no)
8. `rooms`
- id, tenant_id(idx), building_id(fk), floor_id(fk), room_no, room_type, capacity, qr_code, status
- unique(tenant_id, building_id, room_no)
9. `beds`
- id, tenant_id(idx), room_id(fk), bed_no, status, qr_code
- unique(tenant_id, room_id, bed_no)

## 4) 索引与约束
- 每张业务表：`idx_<table>_tenant_id`
- 高频查询：
  - floors(building_id)
  - rooms(building_id, floor_id)
  - beds(room_id, status)
- 外键均为逻辑同租户数据（业务层强校验 tenant_id）

## 5) 状态机
- Room.status: `active | maintenance | closed`
- Bed.status: `vacant | occupied | reserved | maintenance`

## 6) 权限点（M1）
- `assets.read`
- `assets.write`
- `assets.delete`

admin 角色默认拥有全部权限。

## 7) 联动规则（M1）
1. 删除楼栋前需无楼层/房间
2. 删除房间前需无床位
3. 床位状态变更：occupied/reserved/maintenance/vacant
4. 资产总览自动汇总统计

## 8) M1 验收点
- 登录成功后可访问资产模块页面
- CRUD 全链路可用
- 所有查询按 tenant_id 自动隔离
- RBAC 校验生效（无权限返回 403）
- Swagger 可见并可调试接口
