# 测试与验收手册

## 1. 自动回归
```bash
python3 scripts/api_regression.py
```
覆盖：登录、A1/A2/B 主要接口、跨模块联动 CHK。

## 2. 本轮新增验收点
- `GET /m4-medication/elders/suggest` 支持长者姓名/编号自动联想
- `GET /m4-medication/orders` 支持分页、关键字、状态过滤，并返回 `elder_name/elder_no`
- `POST /m4-medication/executions` 成功后自动新增 M7 账单条目并累计发票金额
- 前端 M4 页面支持姓名显示替代 ID、分页搜索、自动联想和一键执行
- `GET /m5-meal/plans`、`GET /m5-meal/orders` 支持分页检索并返回姓名化字段
- `POST /m5-meal/orders` 成功后自动新增 M7“膳食供应”计费条目
- 前端 M5 页面支持长者自动联想、姓名展示、方案/订单双列表分页
- `GET /m7-billing/items`、`GET /m7-billing/invoices` 支持分页/搜索/状态筛选，并返回 `elder_name/elder_no`
- `POST /m7-billing/invoices/generate` 支持按账期自动生成发票
- `POST /m7-billing/invoices/{id}/writeoff` 支持部分核销/全额核销状态流转
- `POST /m7-billing/invoices/{id}/exception` 支持逾期/争议/豁免/重开
- `GET /m7-billing/invoices/{id}/events` 可查看收费过程事件流水
- 前端 M7 页面支持姓名化展示（不直出长者ID）、双列表分页与业务操作
- `GET /oa1-shift/templates`、`GET /oa1-shift/assignments` 支持分页/检索/筛选
- OA1 排班列表返回 `user_name/username/shift_name`，前端以姓名展示替代纯 user_id
- `POST /oa1-shift/assignments/{id}/status` 支持草稿/已发布/已执行/异常/重开流转
- 前端 OA1 页面支持模板+排班双列表与状态操作
- `GET /b2-family/elders/{id}/overview` 可返回长者与最近体征
- `GET /b2-family/services/catalog` 可返回项目和套餐
- `POST /b2-family/services/order` 可创建增购订单（elder_package）
- 前端 B2 页签可完成“总览查看 + 服务下单”

## 3. 手工验收顺序
1) 登录 -> 创建长者并入院  
2) 配置服务并生成/完成任务  
3) 打开 B2，查看总览/账单/护理记录  
4) 服务增购下单并确认数据写入
